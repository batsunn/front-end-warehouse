## 宏任务，微任务

```javascript
async  function  async1 ()  {
    console.log('async1 start');//3.立即执行
    await  async2();//4.执行async2(),遇到await,后面代码进入微任务队列
    console.log('async1 end')
}
async  function  async2 ()  {
    console.log('async2')
}
console.log('script start');//1.先走同步
setTimeout(function ()  {
    console.log('setTimeout')//5.进入宏任务队列
},  0);
async1();//2.函数调用，直接进入
new  Promise(function (resolve)  {
    console.log('promise1');//6.同步代码，立即执行
    resolve()
}).then(function ()  {//7.then()进入微任务队列
    console.log('promise2')
});
console.log('script end')//8.同步代码，立即调用
```

1.js是单线程的，代码从上往下指向

2.遇到异步，异步先排队，先执行同步，例如console,或者函数的**立即**调用**注意：promise的then之前的代码也是同步的**

3.执行完同步代码再执行异步，异步里面先执行微任务，再执行宏任务

4.promise的.then是微任务，微任务按微任务顺序执行

5.最后执行宏任务，定时器在宏任务的最后

**6.await xxx是从右向左执行的，遇到await以后才被告知异步，进入异步微任务**

### 补充

宏任务，macrotask也叫tasks。一些异步任务的回调会一次进入macro task queue，等待后续被继续调用，这些异步任务包括：

- setTimeout
- setInterval
- setImmwsiate(Node独有)
- I/O
- UI rendering(浏览器独有)

微任务，microtask,也叫jobs。另一些异步任务的回调会一次进入micro task queue，等待后续被调用，这些异步任务包括

- process.NextTick(Node独有)
- Promise.then()
- Object.observe
- MutationObserver
- （注：这里只针对浏览器和NodeJs）